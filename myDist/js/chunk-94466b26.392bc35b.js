(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-94466b26"],{"235a":function(t,e,a){"use strict";var n=a("3ff8");a.n(n).a},"3ff8":function(t,e,a){},"4aee":function(t,e,a){},"4d63":function(t,e,a){var n=a("83ab"),i=a("da84"),s=a("94ca"),l=a("7156"),o=a("9bf2").f,r=a("241c").f,u=a("44e7"),c=a("ad6d"),p=a("9f7f"),m=a("6eeb"),f=a("d039"),d=a("69f3").set,h=a("2626"),C=a("b622")("match"),b=i.RegExp,v=b.prototype,g=/a/g,D=/a/g,y=new b(g)!==g,k=p.UNSUPPORTED_Y;if(n&&s("RegExp",!y||k||f((function(){return D[C]=!1,b(g)!=g||b(D)==D||"/a/i"!=b(g,"i")})))){for(var F=function(t,e){var a,n=this instanceof F,i=u(t),s=void 0===e;if(!n&&i&&t.constructor===F&&s)return t;y?i&&!s&&(t=t.source):t instanceof F&&(s&&(e=c.call(t)),t=t.source),k&&((a=!!e&&e.indexOf("y")>-1)&&(e=e.replace(/y/g,"")));var o=l(y?new b(t,e):b(t,e),n?this:v,F);return k&&a&&d(o,{sticky:a}),o},S=function(t){t in F||o(F,t,{configurable:!0,get:function(){return b[t]},set:function(e){b[t]=e}})},_=r(b),x=0;_.length>x;)S(_[x++]);v.constructor=F,F.prototype=v,m(i,"RegExp",F)}h("RegExp")},7961:function(t,e,a){"use strict";var n=(a("99af"),a("4de4"),a("7db0"),a("4160"),a("caad"),a("a15b"),a("d81d"),a("a434"),a("a9e3"),a("4d63"),a("ac1f"),a("25f0"),a("2532"),a("5319"),a("159b"),a("2909")),i=a("ade3"),s=a("5530"),l=(a("96cf"),a("1da1")),o=a("31e0"),r=a("3eca"),u=a("6e84"),c=a("2387"),p=a("a9e4"),m=a("ad32"),f={props:{visible:{type:Boolean,default:!1},prop:{type:Object,default:null}},components:{CommonDialogComp:m.a},data:function(){return{optionList:[]}},computed:{checkedList:function(){return Array.isArray(this.optionList)&&0!==this.optionList.length?this.optionList.filter((function(t){return t.IsChecked})):[]},checkAll:{get:function(){return this.checkedList.length===this.optionList.length&&this.checkedList.length>0},set:function(t){this.optionList.forEach((function(e){e.IsChecked=t}))}},indeterminateAll:function(){return this.checkedList.length>0&&this.checkedList.length<this.optionList.length},showList:function(){if(!Array.isArray(this.optionList)||0===this.optionList.length)return[];var t=[];return this.optionList.forEach((function(e){var a=e.Part?"".concat(e.Part.Name,"工艺"):"产品工艺",n=t.find((function(t){return t.Name===a}));n?n.List.push(e):t.push({Name:a,List:[e]})})),t}},methods:{onSubmit:function(){var t=this,e=this.optionList.filter((function(t){return t.IsChecked})).find((function(e){return e.DefaultValue&&!t.$utils.getValueIsOrNotNumber(e.DefaultValue)}));e?this.messageBox.failSingleError("保存失败","[".concat(e.Name,"] 默认值不是数字类型")):this.$emit("submit",this.optionList)},onCancle:function(){this.$emit("update:visible",!1)},onOpen:function(){this.$nextTick(this.initEditData)},onClosed:function(){this.optionList=[]},initEditData:function(){if(this.prop){var t=this.prop.CraftOptionList;Array.isArray(t)&&(this.optionList=JSON.parse(JSON.stringify(t)))}},onItemChange:function(t,e,a){var n=this.optionList.find((function(t){return t.ID===e.ID&&JSON.stringify(t.Part)===JSON.stringify(e.Part)}));n&&(n[a]=t)}}},d=(a("235a"),a("2877")),h=Object(d.a)(f,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("CommonDialogComp",{staticClass:"mp-erp-comps-pruduct-module-all-cost-formula-cost-setup-dialog-comp-wrap",attrs:{width:"880px",top:"12vh",title:"费用选择",visible:t.visible,submitText:"确定"},on:{"update:visible":function(e){t.visible=e},submit:t.onSubmit,cancle:t.onCancle,open:t.onOpen,closed:t.onClosed}},[a("p",[a("el-checkbox",{attrs:{indeterminate:t.indeterminateAll},model:{value:t.checkAll,callback:function(e){t.checkAll=e},expression:"checkAll"}},[t._v("全选")])],1),t._l(t.showList,(function(e){return a("div",{key:e.Name},[a("p",{staticClass:"mp-common-title-wrap black"},[t._v(t._s(e.Name))]),a("ul",t._l(e.List,(function(e){return a("li",{key:e.ID},[a("el-checkbox",{attrs:{value:e.IsChecked,title:e.Name},on:{change:function(a){return t.onItemChange(a,e,"IsChecked")}}},[t._v(t._s(e.Name))]),a("div",{directives:[{name:"show",rawName:"v-show",value:e.IsChecked,expression:"it.IsChecked"}],staticClass:"set-default"},[a("span",[t._v("空值设为：")]),a("el-input",{attrs:{type:"small",value:e.DefaultValue,maxlength:"9"},on:{input:function(a){t.onItemChange(a.trim(),e,"DefaultValue")}}}),a("span",[t._v("元")])],1)],1)})),0)])}))],2)}),[],!1,null,null,null).exports,C={props:{PositionID:{type:String,default:""},moduleIndex:{type:Number,default:0},NowEditFormulaData:{type:Object,default:null},curSubFormulaAddProperty:{type:Object,default:null},curEditSubFormulaData:{type:Object,default:null},Condition4getProperty:{type:Object,default:null},pageTitle:{type:String,default:""},pageLabel:{type:String,default:"当前物料类型"},PositionType:{type:String,default:""},hiddenUnit:{type:Boolean,default:!1},hiddenHeader:{type:Boolean,default:!1},isSingle:{type:Boolean,default:!1},FormulaLabel:{type:String,default:"公式名称"},PriceID:{type:String,default:""}},components:{LRWidthDragAutoChangeComp:u.a,FormulaPanelElementSelectDialog:p.a,TipsSpanButton:c.a,FormulaCostOptionSetupDialog:h},data:function(){return{PropertyList:null,FormulaData:null,selectVisible:!1,ArithmeticOperatorList:[{label:"+",isMini:!0,value:"+",num:0},{label:"-",isMini:!0,value:"-",num:0},{label:"×",isMini:!0,value:"*",num:0},{label:"÷",isMini:!0,value:"/",num:0},{label:"(",isMini:!1,value:"(",num:0},{label:")",isMini:!1,value:")",num:0},{label:"取余",isMini:!1,value:"%",num:0},{label:"向上取整",isMini:!1,value:"Ceiling()",num:-1},{label:"向下取整",isMini:!1,value:"Floor()",num:-1},{label:"最大值",isMini:!1,value:"Max()",num:-1},{label:"最小值",isMini:!1,value:"Min()",num:-1}],CalculateRes:"",isloading:!1,CostSetupVisible:!1,curSetupCostProp:null}},computed:{selectedElementIDs:function(){return this.FormulaData&&this.FormulaData.PropertyList&&Array.isArray(this.FormulaData.PropertyList)?this.FormulaData.PropertyList.map((function(t){return t.StoredContent})):[]},haveInputElementList:function(){var t=this;return this.FormulaData&&this.FormulaData.PropertyList&&Array.isArray(this.FormulaData.PropertyList)&&this.FormulaData.Content.length>0?this.FormulaData.PropertyList.filter((function(e){return t.FormulaData.Content.includes(e.DisplayContent)})):[]},watchContent:function(){return this.FormulaData?this.FormulaData.Content:""},isSubFormula:function(){return 2===this.moduleIndex||4===this.moduleIndex},subFromulaDialogTitle:function(){return this.isSubFormula&&this.curSubFormulaAddProperty?"当前设置子公式：".concat(this.curSubFormulaAddProperty.DisplayContent.replace(/\[|\]/g,"")):""}},methods:{initData:function(){var t=this;return Object(l.a)(regeneratorRuntime.mark((function e(){var a,n,l,u,c,p;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.isloading){e.next=2;break}return e.abrupt("return");case 2:return t.isloading=!0,t.isSubFormula?(t.curEditSubFormulaData&&(n=Object(s.a)({},t.curEditSubFormulaData),l=r.d.getPropIDsObj(t.curEditSubFormulaData)),t.curSubFormulaAddProperty&&(l=r.d.getPropIDsObj(t.curSubFormulaAddProperty),n=Object(s.a)({},l,{UseModule:t.moduleIndex})),l.UseModule=t.moduleIndex):t.NowEditFormulaData?n=Object(s.a)({},t.NowEditFormulaData):(u={},Object(i.a)(u,t.PositionType,t.PositionID),Object(i.a)(u,"UseModule",t.moduleIndex),Object(i.a)(u,"PriceID",t.PriceID),n=u),c=t.isSubFormula?n:(a={},Object(i.a)(a,t.PositionType,t.PositionID),Object(i.a)(a,"UseModule",t.moduleIndex),a),t.Condition4getProperty&&(c=t.Condition4getProperty),t.FormulaData=new o.b(n),e.next=9,r.d.getPropertyList(c);case 9:p=e.sent,t.isloading=!1,p?(t.PropertyList=p,t.initPropertyListReplaceHelper()):t.onGoBackClick();case 12:case"end":return e.stop()}}),e)})))()},onGoBackClick:function(t){this.$emit("goback",t)},initPropertyListReplaceHelper:function(){var t=this;0!==this.FormulaData.PropertyList.length&&(this.FormulaData.PropertyList=this.FormulaData.PropertyList.map((function(e){var a=r.d.getPerfectPropertyByImperfectProperty(e,t.PropertyList);return a?Object(s.a)({},a,{DefaultValue:e.DefaultValue}):null})).filter((function(t){return t})))},onElementAddClick:function(){this.selectVisible=!0},onElementSelect:function(t){this.FormulaData&&t&&this.FormulaData.PropertyList.push(t)},deleteElement:function(t,e){if(this.FormulaData&&(e||0===e)){this.FormulaData.PropertyList.splice(e,1);var a=t.DisplayContent.replace("[","").replace("]",""),n=new RegExp("\\[".concat(a,"\\]"),"g");this.FormulaData.Content=this.FormulaData.Content.replace(n,"")}},joinElement:function(t){t&&t.DisplayContent&&this.insertVariable(t.DisplayContent)},insertVariable:function(t){var e=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return Object(l.a)(regeneratorRuntime.mark((function n(){var i,s,l;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(i=document.querySelector(".mp-erp-common-comps-formula-set-panel-comp-right-content-wrap .el-textarea__inner")){n.next=4;break}return e.messageBox.failSingle("获取公式输入对象失败"),n.abrupt("return");case 4:if(!i.selectionStart&&0!==i.selectionStart){n.next=14;break}return s=i.selectionStart,l=i.selectionEnd,e.FormulaData.Content=i.value.substring(0,s)+t+i.value.substring(l,i.value.length),n.next=10,e.$nextTick();case 10:i.focus(),i.setSelectionRange(l+t.length+a,l+t.length+a),n.next=15;break;case 14:e.FormulaData.Content=t;case 15:case"end":return n.stop()}}),n)})))()},onArithmeticOperatorClick:function(t){t&&this.insertVariable(t.value,t.num||0)},submitSave:function(t){var e=this;return Object(l.a)(regeneratorRuntime.mark((function a(){var n,i,s,l;return regeneratorRuntime.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,e.api.getFormulaSave(t).catch((function(){}));case 2:(n=a.sent)&&200===n.status&&1e3===n.data.Status&&(i=!!t.ID,s=i?"编辑成功":"添加成功",l=function(){e.$emit("successSubmit",[i,t,n.data.Data]),e.onGoBackClick("success")},e.messageBox.successSingle(s,l,l));case 4:case"end":return a.stop()}}),a)})))()},useCalculate:function(t){var e=this;return Object(l.a)(regeneratorRuntime.mark((function a(){var n;return regeneratorRuntime.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,e.api.getFormulaCalculate(t).catch((function(){}));case 2:(n=a.sent)&&200===n.status&&1e3===n.data.Status&&(e.CalculateRes=n.data.Data);case 4:case"end":return a.stop()}}),a)})))()},onSubmitClick:function(){o.b.checkSubmit(this.FormulaData)&&this.submitSave(this.FormulaData)},onCalculateClick:function(){o.b.checkCalculate(this.FormulaData)&&(this.CalculateRes="",this.useCalculate(this.FormulaData))},onCalculateInput:function(){this.CalculateRes=""},getFormulaData:function(){return o.b.checkSubmit(this.FormulaData,this.hiddenHeader)?this.FormulaData:null},getCostSelectedText:function(t){if(!t||!Array.isArray(t.CraftOptionList)||0===t.CraftOptionList.length)return"";var e=[];return t.CraftOptionList.filter((function(t){return t.IsChecked})).forEach((function(t){var a=t.Part?"".concat(t.Part.Name):"产品",n=t.DefaultValue||0===t.DefaultValue?"（".concat(t.DefaultValue,"）"):"",i=e.find((function(t){return t.Name===a}));i?i.List.push("".concat(t.Name).concat(n)):e.push({Name:a,List:["".concat(t.Name).concat(n)]})})),e.map((function(t){var e=t.Name,a=t.List.join("、");return"".concat(e,"：").concat(a)})).join(" ")},onCostSetupClick:function(t){t&&(this.curSetupCostProp=t,this.CostSetupVisible=!0)},onCostSetupSubmit:function(t){var e,a=this,i=null===(e=this.FormulaData)||void 0===e?void 0:e.PropertyList.find((function(t){return t.StoredContent===a.curSetupCostProp.StoredContent}));i&&(i.CraftOptionList=Object(n.a)(t)),this.CostSetupVisible=!1}},watch:{watchContent:function(){this.CalculateRes=""}},mounted:function(){this.initData()}},b=(a("ef80"),Object(d.a)(C,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("section",{staticClass:"mp-erp-common-comps-formula-set-panel-comp--wrap",class:{isSingle:t.isSingle}},[t.hiddenHeader?t._e():a("header",[a("span",[t._v(t._s(t.pageLabel)+"：")]),a("span",[t._v(t._s(t.pageTitle))]),t._t("title"),t.FormulaData?a("div",[a("div",[a("span",[t._v(t._s(t.FormulaLabel)+"：")]),a("el-input",{staticStyle:{width:"250px"},attrs:{size:"small",maxlength:"6","show-word-limit":""},model:{value:t.FormulaData.Name,callback:function(e){t.$set(t.FormulaData,"Name","string"==typeof e?e.trim():e)},expression:"FormulaData.Name"}})],1),t.hiddenUnit?t._e():a("div",[a("span",[t._v("结果单位：")]),a("el-input",{staticStyle:{width:"125px"},attrs:{size:"small",maxlength:"6","show-word-limit":""},model:{value:t.FormulaData.Unit,callback:function(e){t.$set(t.FormulaData,"Unit","string"==typeof e?e.trim():e)},expression:"FormulaData.Unit"}})],1)]):t._e()],2),a("main",[t.PropertyList&&t.FormulaData?a("LRWidthDragAutoChangeComp",{attrs:{leftWidth:t.isSingle?"100%":"45%",single:t.isSingle},scopedSlots:t._u([{key:"left",fn:function(){return[a("section",{staticClass:"mp-erp-common-comps-formula-set-panel-comp-left-content-wrap"},[a("header",[a("p",{staticClass:"btn-box"},[t.isSingle?a("span",{staticClass:"blue-span",on:{click:t.onElementAddClick}},[t._v("+添加元素")]):a("el-button",{attrs:{type:"primary",size:"small"},on:{click:t.onElementAddClick}},[t._v("+添加元素")])],1),a("p",{staticClass:"tips-box"},[a("span",{staticClass:"lt"},[a("i",{staticClass:"el-icon-warning"}),t._v("注： ")]),a("span",{staticClass:"rt"},[a("i",[t._v("当为空值时设置的值指当某一界面元素被禁用/隐藏或者客户未选择未填写任何值时，以此值参与运算")]),t.isSingle?a("i",[t._v("表数据指根据当前数据表匹配的结果数值，如果没有任何匹配，则此公式运算结果为空。")]):t._e()])])]),a("main",[t.isSingle?t._e():a("p",{staticClass:"module-title"},[t._v("已选元素概览")]),a("ul",t._l(t.FormulaData.PropertyList,(function(e,n){return a("li",{key:e.StoredContent+""+n},[e.TipsContent?a("TipsSpanButton",{staticClass:"name",attrs:{text:e.DisplayContent,tipContent:e.TipsContent}}):a("span",{staticClass:"name",class:{"is-bold":8===e.Type||9===e.Type}},[t._v(t._s(e.DisplayContent))]),a("span",{staticClass:"default"},[8===e.Type||9===e.Type&&e.CraftOptionList&&e.CraftOptionList.length>0?t._e():[a("i",[t._v("空值设为：")]),a("el-input",{attrs:{size:"small"},model:{value:e.DefaultValue,callback:function(a){t.$set(e,"DefaultValue","string"==typeof a?a.trim():a)},expression:"it.DefaultValue"}}),a("i",[t._v(" "+t._s(e.Unit))])],9===e.Type&&e.CraftOptionList&&e.CraftOptionList.length>0?[a("span",{staticClass:"cost-selected-text",attrs:{title:t.getCostSelectedText(e)}},[t._v(t._s(t.getCostSelectedText(e)))]),a("span",{staticClass:"blue-span",on:{click:function(a){return t.onCostSetupClick(e)}}},[t._v("选择")])]:t._e()],2),a("span",{staticClass:"del",on:{click:function(a){return t.deleteElement(e,n)}}},[a("i"),t._v("删除")]),a("span",{staticClass:"join blue-span",on:{click:function(a){return t.joinElement(e)}}},[t._v("加入 "),a("i",{staticClass:"el-icon-d-arrow-right"})])],1)})),0),t.isSingle?a("section",{staticClass:"mp-erp-common-comps-formula-set-panel-comp-right-content-wrap show-left"},[a("header",[a("p",{staticClass:"module-title"},[t._v("公式")])]),a("main",[a("el-input",{attrs:{type:"textarea",autosize:{minRows:10,maxRows:100}},model:{value:t.FormulaData.Content,callback:function(e){t.$set(t.FormulaData,"Content","string"==typeof e?e.trim():e)},expression:"FormulaData.Content"}}),a("div",{staticClass:"ctrl-box"},t._l(t.ArithmeticOperatorList,(function(e){return a("span",{key:e.value,class:e.isMini?"mini":"",on:{click:function(a){return t.onArithmeticOperatorClick(e)}}},[t._v(t._s(e.label))])})),0),a("p",{staticClass:"intro"},[a("span",[t._v("公式说明：")]),a("el-input",{attrs:{size:"small",maxlength:"50","show-word-limit":""},model:{value:t.FormulaData.Remark,callback:function(e){t.$set(t.FormulaData,"Remark","string"==typeof e?e.trim():e)},expression:"FormulaData.Remark"}})],1),a("p",{staticClass:"module-title"},[t._v("试算")]),a("div",{staticClass:"test-box"},[a("div",t._l(t.FormulaData.PropertyList,(function(e){return a("div",{key:e.DisplayContent},[a("span",{attrs:{title:e.DisplayContent}},[t._v(t._s(e.DisplayContent)+"：")]),a("el-input",{attrs:{size:"small",disabled:!t.FormulaData.Content.includes(e.DisplayContent)},on:{input:t.onCalculateInput},model:{value:e.CalculateValue,callback:function(a){t.$set(e,"CalculateValue","string"==typeof a?a.trim():a)},expression:"it.CalculateValue"}}),a("span",[t._v(t._s(e.Unit))])],1)})),0),a("p",[a("span",{staticClass:"blue-span",class:t.FormulaData&&t.FormulaData.Content?"":"disabled",on:{click:t.onCalculateClick}},[t._v("测试运算")]),t.CalculateRes||0===t.CalculateRes?a("span",[t._v("测试运算结果："),a("i",{staticClass:"is-pink"},[t._v(t._s(t.CalculateRes))])]):t._e()])])],1)]):t._e()])])]},proxy:!0},t.isSingle?null:{key:"right",fn:function(){return[a("section",{staticClass:"mp-erp-common-comps-formula-set-panel-comp-right-content-wrap"},[a("header",[a("p",{staticClass:"module-title"},[t._v("公式")])]),a("main",[a("el-input",{attrs:{type:"textarea",autosize:{minRows:10,maxRows:100}},model:{value:t.FormulaData.Content,callback:function(e){t.$set(t.FormulaData,"Content","string"==typeof e?e.trim():e)},expression:"FormulaData.Content"}}),a("div",{staticClass:"ctrl-box"},t._l(t.ArithmeticOperatorList,(function(e){return a("span",{key:e.value,class:e.isMini?"mini":"",on:{click:function(a){return t.onArithmeticOperatorClick(e)}}},[t._v(t._s(e.label))])})),0),a("p",{staticClass:"intro"},[a("span",[t._v("公式说明：")]),a("el-input",{attrs:{size:"small",maxlength:"50","show-word-limit":""},model:{value:t.FormulaData.Remark,callback:function(e){t.$set(t.FormulaData,"Remark","string"==typeof e?e.trim():e)},expression:"FormulaData.Remark"}})],1),a("p",{staticClass:"module-title"},[t._v("试算")]),a("div",{staticClass:"test-box"},[a("div",t._l(t.FormulaData.PropertyList,(function(e){return a("div",{key:e.DisplayContent},[a("span",{attrs:{title:e.DisplayContent}},[t._v(t._s(e.DisplayContent)+"：")]),a("el-input",{attrs:{size:"small",disabled:!t.FormulaData.Content.includes(e.DisplayContent)},on:{input:t.onCalculateInput},model:{value:e.CalculateValue,callback:function(a){t.$set(e,"CalculateValue","string"==typeof a?a.trim():a)},expression:"it.CalculateValue"}}),a("span",[t._v(t._s(e.Unit))])],1)})),0),a("p",[a("span",{staticClass:"blue-span",class:t.FormulaData&&t.FormulaData.Content?"":"disabled",on:{click:t.onCalculateClick}},[t._v("测试运算")]),t.CalculateRes||0===t.CalculateRes?a("span",[t._v("测试运算结果："),a("i",{staticClass:"is-pink"},[t._v(t._s(t.CalculateRes))])]):t._e()])])],1)])]},proxy:!0}],null,!0)}):t._e(),a("FormulaCostOptionSetupDialog",{attrs:{visible:t.CostSetupVisible,prop:t.curSetupCostProp},on:{"update:visible":function(e){t.CostSetupVisible=e},submit:t.onCostSetupSubmit}}),t.PropertyList&&t.FormulaData?a("FormulaPanelElementSelectDialog",{attrs:{useType:"formula",DialogTitle:t.subFromulaDialogTitle,visible:t.selectVisible,list:t.PropertyList,selectedElementIDs:t.selectedElementIDs},on:{"update:visible":function(e){t.selectVisible=e},submit:t.onElementSelect}}):t._e()],1),t.isSingle?t._e():a("footer",[a("el-button",{attrs:{type:"primary"},on:{click:t.onSubmitClick}},[t._v("保存")]),a("el-button",{staticClass:"go-back",on:{click:t.onGoBackClick}},[t._v("返回")])],1)])}),[],!1,null,null,null));e.a=b.exports},ef80:function(t,e,a){"use strict";var n=a("4aee");a.n(n).a}}]);