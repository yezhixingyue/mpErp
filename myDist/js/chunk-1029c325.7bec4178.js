(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-1029c325"],{"2af0":function(t,e,a){"use strict";a("4de4"),a("7db0"),a("c740"),a("caad"),a("d81d"),a("a434"),a("2532");var o=a("3835"),i=a("2909"),n=a("5530"),r=a("aa47"),s=a("c117"),c=a("2f62");e.a={data:function(){return{h:0,sortItem:null,tableKey:this.$utils.getRandomRangeId(8),notify:null,hideColLabelList:[],localShowLabelList:[]}},watch:{h:function(t){this.h=t;var e=document.getElementsByClassName("el-table")[0];e&&(e.style.maxHeight="".concat(t,"px"))},hideColLabelList:function(){var t=this;this.tableColData=this.tableColData.map((function(e){var a=Object(n.a)({},e);return t.hideColLabelList.includes(e.label)?a.show=!1:a.show=!0,a}))},isLeftCollapse:function(t){var e=this;setTimeout((function(){e.setHeightByDebounce()}),t?700:450)}},computed:Object(n.a)({},Object(c.e)("layout",["isLeftCollapse"]),{colLabels:function(){return this.tableColData?this.tableColData.map((function(t){return t.label})):[]},curShowColTableData:function(){return this.tableColData?this.tableColData.filter((function(t){return t.show})):[]}}),methods:{getHeight:function(t,e){var a=document.querySelector("#app > section > main");if(!a)return 600;var o=t?document.querySelector(t):null;return(o?a.offsetHeight-o.offsetHeight:a.offsetHeight)-e},initHeightAuto:function(){var t=this;this.$nextTick((function(){return t.setHeightByDebounce()})),window.addEventListener("resize",this.setHeightByDebounce)},removeHeightAuto:function(){window.removeEventListener("resize",this.setHeightByDebounce)},onHeaderDragend:function(t,e,a){var o=this;if(this.tableColData){var i=this.tableColData.find((function(t){return t.label===a.label}));if(i&&(i.width&&(i.width="".concat(t,"px")),i.minWidth&&(i.minWidth="".concat(t,"px"))),this.sortItem){try{this.sortItem.destroy()}catch(t){}this.$nextTick((function(){o.commonTableSortMixin()}))}}},commonTableSortMixin:function(){if(this.tableColData){var t=document.querySelector(".el-table__header thead tr"),e={onEnd:this.handleSortEnd};try{this.sortItem=r.a.create(t,e)}catch(t){}}},handleSortEnd:function(t){var e=this,a=t.oldIndex-1,n=t.newIndex-1;if(this.curShowColTableData.length<this.tableColData.length&&this.curShowColTableData[a]){var r=this.curShowColTableData[a].label,s=this.tableColData.findIndex((function(t){return t.label===r}));if(s>=0&&(a=s),n>0){var c=this.curShowColTableData[n-1].label,l=this.tableColData.findIndex((function(t){return t.label===c}));l>=0&&(n=l+1)}}var u=Object(i.a)(this.tableColData),d=u.splice(a,1),h=Object(o.a)(d,1)[0];u.splice(n,0,h),this.tableColData=u,this.tableKey=this.$utils.getRandomRangeId(8),this.$nextTick((function(){e.commonTableSortMixin()}))},handleMountedAndActivated:function(){var t=this;if(this.setHeightByDebounce=Object(s.a)(this.setHeight,30),this.initHeightAuto(),this.commonTableSortMixin(),this.tableName){var e=JSON.parse(localStorage.getItem(this.tableName));e.length>0&&(e=e.filter((function(e){return t.colLabels.includes(e)}))),this.hideColLabelList=e}},handleDestroyAndDeactivated:function(){if(this.removeHeightAuto(),this.sortItem)try{this.sortItem.destroy()}catch(t){}},onInfoClick:function(){var t=this,e=this.$createElement;if(this.tableColData){var a=160;this.$refs.oElTable&&this.$refs.oElTable.$el&&this.$refs.oElTable.$el.offsetTop&&(a=this.$refs.oElTable.$el.offsetTop-17),this.localShowLabelList=this.colLabels.filter((function(e){return!t.hideColLabelList.includes(e)}));var o=function(){t.notify&&t.notify.close()},n=function(e){var a=t.localShowLabelList.findIndex((function(t){return t===e}));a>=0?t.localShowLabelList.splice(a,1):t.localShowLabelList.push(e)},r=e("section",{class:"content-box"},[e("main",[e("el-checkbox-group",{attrs:{value:this.localShowLabelList}},[this.tableColData.map((function(t){return e("el-checkbox",{on:{change:function(){return n(t.label)}},attrs:{label:t.label},key:t.label})}))])]),e("footer",[e("el-button",{on:{click:function(){t.hideColLabelList=t.colLabels.filter((function(e){return!t.localShowLabelList.includes(e)})),t.tableName&&localStorage.setItem(t.tableName,JSON.stringify(t.hideColLabelList)),o()}},attrs:{type:"primary"}},["保存"]),e("el-button",{on:{click:o}},["关闭"]),e("span",{class:"span-title-blue",on:{click:function(){var e,a=t.colLabels.filter((function(e){return!t.localShowLabelList.includes(e)}));(e=t.localShowLabelList).push.apply(e,Object(i.a)(a))}}},["重置"]),e("p",{class:"is-gray"},[e("span",["1. 没有被选中的列将会被隐藏"]),e("span",["2. 列显示隐藏设置会缓存至本地，在不清除缓存或版本更新的情况下，下次打开会自动延续本次设置"]),e("span",["3. 中间列可左右拖动（不被缓存）"])])])]);this.notify=this.$notify({title:"设置列显示",customClass:"mp-erp-table-column-show-setup-wrap",duration:0,message:r,offset:a})}}},mounted:function(){this.handleMountedAndActivated()},beforeDestroy:function(){this.handleDestroyAndDeactivated()},activated:function(){this.handleMountedAndActivated()},deactivated:function(){this.handleDestroyAndDeactivated()}}},"55a5":function(t,e,a){},"5b1e":function(t,e,a){"use strict";a.r(e);var o=(a("99af"),a("4de4"),a("7db0"),a("d81d"),a("b0c0"),a("ac1f"),a("5319"),a("96cf"),a("1da1")),i=a("5530"),n=a("2f62"),r=(a("a15b"),a("2af0")),s=a("3eca"),c={props:{dataList:{default:function(){return[]},type:Array},loading:{type:Boolean,default:!1},PropertyList:{default:function(){return[]},type:Array}},computed:{localTableData:function(){var t=this;return this.dataList&&Array.isArray(this.dataList)&&0!==this.dataList.length?this.dataList.map((function(e){return Object(i.a)({},e,{PriorityText:"".concat(e.Priority,"级"),FilterTypeText:1===e.Constraint.FilterType?"满足所有条件":"满足任一条件",defaultFactoryName:t.getDefaultFactory(e.FactoryList),unDelaultFactoryListName:t.getUnDefaultFactory(e.FactoryList),conditionText:t.getConditionText(e.Constraint.ItemList)})})):[]}},mixins:[r.a],methods:{setHeight:function(){var t=this.getHeight(".mp-erp-product-list-page-product-factory-set-comp-wrap > header",110);this.h=t},onEditClick:function(t){this.$emit("edit",t)},onRemoveClick:function(t,e){this.$emit("remove",t,e)},getDefaultFactory:function(t){var e=t.find((function(t){return t.IsDefault}));return e?e.Factory.FactoryName:""},getUnDefaultFactory:function(t){return t.filter((function(t){return!t.IsDefault})).map((function(t){return t.Factory.FactoryName})).join("、")},getConditionText:function(t){return s.d.getPropertyConditionText(t,this.PropertyList)||"无"}}},l=(a("a622"),a("2877")),u={name:"ProductFactorySetPage",data:function(){return{ProductID:"",PartID:"",ProductName:"",titleType:"",curEditData:null,loading:!1}},components:{FactoryTable:Object(l.a)(c,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-table",{key:"mp-erp-product-module-factory-list-page-factory-table-comp-wrap",staticClass:"mp-erp-product-module-factory-list-page-factory-table-comp-wrap",staticStyle:{width:"100%"},attrs:{"max-height":t.h,height:t.h,stripe:"",border:"",data:t.localTableData,fit:""}},[a("el-table-column",{attrs:{prop:"conditionText",label:"条件","min-width":"260"},scopedSlots:t._u([{key:"default",fn:function(e){return["object"==typeof e.row.conditionText?a("el-tooltip",{attrs:{effect:"light","popper-class":"common-property-condition-text-tips-box"}},[a("div",{attrs:{slot:"content"},slot:"content"},t._l(e.row.conditionText,(function(o,i){return a("p",{key:o.name+"tips"+i},[i>0?a("span",{staticClass:"type"},[t._v(t._s(1===e.row.Constraint.FilterType?"且":"或"))]):t._e(),a("span",{staticClass:"name"},[t._v(t._s(o.name))]),a("span",{staticClass:"is-origin"},[t._v(t._s(o.operator))]),a("span",{staticClass:"val"},[t._v(t._s(o.val))]),i===e.row.conditionText.length-1?a("span",{staticStyle:{"margin-left":"2px"}},[t._v(" 。")]):a("span",{staticStyle:{"margin-left":"2px"}},[t._v("；")])])})),0),a("div",{staticClass:"common-property-condition-text-content-box"},t._l(e.row.conditionText,(function(o,i){return a("p",{key:o.name+"content"+i},[i>0?a("span",{staticClass:"type"},[t._v(t._s(1===e.row.Constraint.FilterType?"且":"或"))]):t._e(),a("span",[t._v(t._s(o.name))]),a("span",{staticClass:"is-origin"},[t._v(t._s(o.operator))]),a("span",[t._v(t._s(o.val))])])})),0)]):t._e(),"string"==typeof e.row.conditionText?a("span",[t._v(t._s(e.row.conditionText))]):t._e()]}}])}),a("el-table-column",{attrs:{prop:"FilterTypeText",label:"条件类型",width:"180","show-overflow-tooltip":""}}),a("el-table-column",{attrs:{prop:"PriorityText",label:"优先级",width:"140","show-overflow-tooltip":""}}),a("el-table-column",{attrs:{prop:"defaultFactoryName",label:"默认生产工厂",width:"180","show-overflow-tooltip":""}}),a("el-table-column",{attrs:{prop:"unDelaultFactoryListName",label:"可选生产工厂",width:"320","show-overflow-tooltip":""}}),a("el-table-column",{attrs:{label:"操作",width:"240"},scopedSlots:t._u([{key:"default",fn:function(e){return a("div",{staticClass:"menu-list"},[a("span",{on:{click:function(a){return t.onEditClick(e.row)}}},[a("i"),t._v("编辑")]),a("span",{on:{click:function(a){return t.onRemoveClick(e.row,e.$index)}}},[a("i"),t._v("删除")])])}}])}),a("div",{attrs:{slot:"empty"},slot:"empty"},[a("span",{directives:[{name:"show",rawName:"v-show",value:!t.loading,expression:"!loading"}]},[t._v("暂无数据")])])],1)}),[],!1,null,null,null).exports},computed:Object(i.a)({},Object(n.e)("productManage",["ProductManageList","ProductModuleKeyIDList","ProductFactoryList","ProductFactoryPropertyList"]),{curProduct:function(){var t=this;return this.ProductID?this.ProductManageList.find((function(e){return e.ID===t.ProductID})):null},curPart:function(){var t=this;return this.PartID&&this.curProduct?this.curProduct.PartList.find((function(e){return e.ID===t.PartID})):null},localTableData:function(){var t=this;return this.ProductFactoryList&&0!==this.ProductFactoryList.length?JSON.parse(JSON.stringify(this.ProductFactoryList)).map((function(e){var a=e.Constraint;return a.ItemList=a.ItemList.map((function(e){var a=s.d.getPerfectPropertyByImperfectProperty(e.Property,t.ProductFactoryPropertyList);return Object(i.a)({},e,{Property:a})})).filter((function(t){return t.Property})),Object(i.a)({},e,{Constraint:a})})):[]}}),methods:{getPositionID:function(){if(this.$route.params){var t=this.$route.params,e=t.ProductID,a=t.PartID,o=t.name,i=t.type;e&&a&&o&&i?(this.ProductID=e,this.PartID="null"!==a?a:"",this.ProductName=o,this.titleType=i,this.getProductOrderData(),this.getPropertyList()):this.onGoBackClick()}else this.onGoBackClick()},onFactorySaveClick:function(t){this.$store.commit("productManage/setCurEditFactoryData",t);var e="/ProductFactoryAdd/".concat(this.ProductID,"/").concat(this.PartID?this.PartID:"null","/").concat(this.ProductName,"/").concat(this.titleType,"/").concat(Date.now());this.$router.push(e)},getProductOrderData:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:["Factory"];return Object(o.a)(regeneratorRuntime.mark((function a(){var o,i,n;return regeneratorRuntime.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return o=t.PartID?t.PartID:t.ProductID,i=t.$utils.getIDFromListByNames(e,t.ProductModuleKeyIDList),n={ID:o,List:i},t.loading=!0,a.next=6,t.$store.dispatch("productManage/getProductFactoryList",n);case 6:t.loading=!1;case 7:case"end":return a.stop()}}),a)})))()},getPropertyList:function(){this.$store.dispatch("productManage/getProductFactoryPropertyList",this.ProductID)},onGoBackClick:function(){this.$router.replace("/ProductManageList")},onRemove:function(t,e){var a=this;this.messageBox.warnCancelBox("确定删除该条设置吗","默认工厂：[ ".concat(t.defaultFactoryName," ]"),(function(){a.$store.dispatch("productManage/getProductFactoryPropertyRemove",[t.ID,e])}))},onEdit:function(t){this.onFactorySaveClick(t)}},mounted:function(){this.getPositionID()}},d=(a("cbaa"),Object(l.a)(u,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("section",{staticClass:"mp-erp-product-list-page-product-factory-set-comp-wrap"},[a("header",[a("span",[t._v("当前"+t._s(t.titleType)+"：")]),a("span",[t._v(t._s(t.ProductName))]),a("p",[a("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(e){return t.onFactorySaveClick(null)}}},[t._v("+添加工厂策略")])],1)]),a("main",[a("FactoryTable",{attrs:{dataList:t.localTableData,loading:t.loading,PropertyList:t.ProductFactoryPropertyList},on:{remove:t.onRemove,edit:t.onEdit}})],1),a("footer",[a("el-button",{on:{click:t.onGoBackClick}},[a("i",{staticClass:"el-icon-d-arrow-left"}),t._v(" 返回")])],1)])}),[],!1,null,null,null));e.default=d.exports},"756f":function(t,e,a){},a622:function(t,e,a){"use strict";var o=a("55a5");a.n(o).a},cbaa:function(t,e,a){"use strict";var o=a("756f");a.n(o).a}}]);