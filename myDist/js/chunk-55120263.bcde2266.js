(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-55120263"],{"61c8":function(e,t,n){"use strict";n.r(t);var a=(n("b0c0"),n("ac1f"),n("5319"),n("5530")),o=n("c362"),i=n("2f62"),r={name:"CraftElementSetPage",components:{CommonElementSetPageComp:o.a},data:function(){return{PositionID:"",craftName:""}},computed:Object(a.a)({},Object(i.e)("basicSet",["craftFetchData"]),{},Object(i.e)("common",["useElementModuleList"]),{curUseElementModule:function(){var e=this.$utils.getIDFromListByNames("Craft",this.useElementModuleList);return e||0===e?e:""},fetchData:{get:function(){return this.craftFetchData},set:function(e){this.$store.commit("basicSet/setCraftFetchData",e)}}}),methods:{getPositionID:function(){if(this.$route.params){var e=this.$route.params,t=e.id,n=e.name;t&&n&&(this.PositionID=t,this.craftName=n)}},onGoBackClick:function(){this.$router.replace("/CraftManageList")},onElementSave:function(e){var t=e.isEdit,n=e.data;this.$store.commit("basicSet/setCraftElementChange",[t,n,this.PositionID])},onElementRemove:function(e){this.$store.commit("basicSet/setCraftElementRemove",[e,this.PositionID])},onElementGroupSave:function(){this.fetchData=!0},onElementGroupRemove:function(){this.fetchData=!0},setFetchData:function(){this.fetchData=!0}},mounted:function(){this.getPositionID()},activated:function(){this.fetchData=!1}},s=(n("ccd1"),n("2877")),u=Object(s.a)(r,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("section",{staticClass:"mp-erp-craft-list-page-element-set-comp-wrap"},[n("header",[n("span",[e._v("当前工艺：")]),n("span",[e._v(e._s(e.craftName))])]),e.PositionID?n("CommonElementSetPageComp",{attrs:{PositionID:e.PositionID,curUseElementModule:e.curUseElementModule},on:{elementSave:e.onElementSave,elementRemove:e.onElementRemove,elementGroupSave:e.onElementGroupSave,elementGroupRemove:e.onElementGroupRemove,copyGroupSuccess:e.setFetchData}}):e._e(),n("footer",[n("el-button",{on:{click:e.onGoBackClick}},[e._v("返回")])],1)],1)}),[],!1,null,null,null);t.default=u.exports},"65dc":function(e,t,n){},c362:function(e,t,n){"use strict";var a=(n("4de4"),n("7db0"),n("c740"),n("4160"),n("caad"),n("d81d"),n("a434"),n("2532"),n("159b"),n("5530")),o=n("2909"),i=(n("96cf"),n("3835")),r=n("1da1"),s=n("05f6"),u={props:{PositionID:{type:String,default:""},GroupID:{type:String,default:""},showGroup:{type:Boolean,default:!0},canRemove:{type:Function,default:null},curUseElementModule:{}},data:function(){return{ElementDataList:[],ElementGroupDataList:[],isLoadingElement:!1,isLoadingGroup:!1}},components:{CommonElementSetComp:s.a},methods:{handleEditSubmitSuccess:function(e){var t=e.saveType,n=e.editData,a=e.ID,o=n,i="编辑"===t;if(i){if(i){var r=this.ElementDataList.findIndex((function(e){return e.ID===o.ID}));r>=0&&this.ElementDataList.splice(r,1,o)}}else o.ID=a,this.ElementDataList.push(o);this.$emit("elementSave",{isEdit:i,data:o})},onElementRemove:function(e){var t=this,n=Object(i.a)(e,2),a=n[0],s=n[1];return Object(r.a)(regeneratorRuntime.mark((function e(){var n,i,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.canRemove||t.canRemove(a)){e.next=3;break}return e.abrupt("return");case 3:if(!(t.ElementGroupDataList&&t.ElementGroupDataList.length>0)){e.next=10;break}if(n=[],t.ElementGroupDataList.forEach((function(e){return n.push.apply(n,Object(o.a)(e.ElementList))})),!n.find((function(e){return e.ID===a}))){e.next=10;break}return t.messageBox.failSingleError("删除失败","该元素在界面元素组中已使用"),e.abrupt("return");case 10:return e.next=12,t.api.getElementRemove(a,s).catch((function(){}));case 12:(i=e.sent)&&200===i.status&&1e3===i.data.Status&&(r=function(){t.ElementDataList=t.ElementDataList.filter((function(e){return e.ID!==a})),t.$emit("elementRemove",a)},t.messageBox.successSingle("删除成功",r,r));case 14:case"end":return e.stop()}}),e)})))()},getElementList:function(){var e=this;return Object(r.a)(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.isLoadingElement=!0,t.next=3,e.api.getElementList({groupID:e.GroupID,positionID:e.PositionID}).catch((function(){}));case 3:(n=t.sent)&&200===n.status&&1e3===n.data.Status&&(e.ElementDataList=n.data.Data),e.isLoadingElement=!1;case 6:case"end":return t.stop()}}),t)})))()},handleGroupSaveSuccess:function(e){var t=this,n=e.saveType,a=e.editData,o=e.ID,i=a,r=function(){var e=i.ElementList.map((function(e){return e.ID}));t.ElementDataList.forEach((function(t){var n=t;e.includes(t.ID)?!n||n.Group&&n.Group.ID===o||(n.Group={ID:o,Name:i.Name}):n.Group&&n.Group.ID===o&&(n.Group=null)}))};if("添加"===n)i.ID=o,this.ElementGroupDataList.push(i),r(),this.$emit("elementGroupSave",{isEdit:!1,data:i});else if("编辑"===n){var s=this.ElementGroupDataList.findIndex((function(e){return e.ID===i.ID}));s>=0&&(this.ElementGroupDataList.splice(s,1,i),r(),this.$emit("elementGroupSave",{isEdit:!0,data:i}))}},onElementGroupRemove:function(e){var t=this,n=Object(i.a)(e,2),a=n[0],o=n[1];return Object(r.a)(regeneratorRuntime.mark((function e(){var n,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.api.getElementGroupRemove(a,o).catch((function(){}));case 2:(n=e.sent)&&200===n.status&&1e3===n.data.Status&&(i=function(){t.ElementGroupDataList.find((function(e){return e.ID===a})).ElementList.forEach((function(e){var n=t.ElementDataList.find((function(t){return t.ID===e.ID}));n&&(n.Group=null)})),t.ElementGroupDataList=t.ElementGroupDataList.filter((function(e){return e.ID!==a})),t.$emit("elementGroupRemove",a)},t.messageBox.successSingle("删除成功",i,i));case 4:case"end":return e.stop()}}),e)})))()},getElementGroupList:function(){var e=this;return Object(r.a)(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.isLoadingGroup=!0,t.next=3,e.api.getElementGroupList(e.PositionID).catch((function(){}));case 3:(n=t.sent)&&200===n.status&&1e3===n.data.Status&&(e.ElementGroupDataList=n.data.Data),e.isLoadingGroup=!1;case 6:case"end":return t.stop()}}),t)})))()},handleSortSuccess:function(e){var t=e.ID,n=e.ElementList,o=this.ElementGroupDataList.find((function(e){return e.ID===t}));o&&(o.ElementList=o.ElementList.map((function(e){var t=n.find((function(t){return t.ID===e.ID}));return t?Object(a.a)({},e,{Index:t.Index}):Object(a.a)({},e)})))},fetchData:function(){this.getElementList(),this.showGroup&&this.getElementGroupList(),this.$emit("copyGroupSuccess")}},mounted:function(){this.getElementList(),this.showGroup&&this.getElementGroupList()}},c=n("2877"),m=Object(c.a)(u,(function(){var e=this,t=e.$createElement;return(e._self._c||t)("CommonElementSetComp",{attrs:{ElementDataList:e.ElementDataList,ElementGroupDataList:e.ElementGroupDataList,isLoadingElement:e.isLoadingElement,isLoadingGroup:e.isLoadingGroup,PositionID:e.PositionID,showGroup:e.showGroup,curUseElementModule:e.curUseElementModule},on:{saveElement:e.handleEditSubmitSuccess,removeElement:e.onElementRemove,saveElementGroup:e.handleGroupSaveSuccess,removeElementGroup:e.onElementGroupRemove,sortGroupElementList:e.handleSortSuccess,copyGroupSuccess:e.fetchData}})}),[],!1,null,null,null);t.a=m.exports},ccd1:function(e,t,n){"use strict";var a=n("65dc");n.n(a).a}}]);