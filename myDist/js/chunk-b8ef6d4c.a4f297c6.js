(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-b8ef6d4c"],{"4aee":function(t,e,a){},"4d63":function(t,e,a){var n=a("83ab"),i=a("da84"),l=a("94ca"),r=a("7156"),s=a("9bf2").f,o=a("241c").f,u=a("44e7"),c=a("ad6d"),m=a("9f7f"),p=a("6eeb"),f=a("d039"),d=a("69f3").set,b=a("2626"),h=a("b622")("match"),D=i.RegExp,C=D.prototype,v=/a/g,y=/a/g,g=new D(v)!==v,F=m.UNSUPPORTED_Y;if(n&&l("RegExp",!g||F||f((function(){return y[h]=!1,D(v)!=v||D(y)==y||"/a/i"!=D(v,"i")})))){for(var k=function(t,e){var a,n=this instanceof k,i=u(t),l=void 0===e;if(!n&&i&&t.constructor===k&&l)return t;g?i&&!l&&(t=t.source):t instanceof k&&(l&&(e=c.call(t)),t=t.source),F&&((a=!!e&&e.indexOf("y")>-1)&&(e=e.replace(/y/g,"")));var s=r(g?new D(t,e):D(t,e),n?this:C,k);return F&&a&&d(s,{sticky:a}),s},x=function(t){t in k||s(k,t,{configurable:!0,get:function(){return D[t]},set:function(e){D[t]=e}})},S=o(D),_=0;S.length>_;)x(S[_++]);C.constructor=k,k.prototype=C,p(i,"RegExp",k)}b("RegExp")},7961:function(t,e,a){"use strict";var n=(a("4de4"),a("caad"),a("d81d"),a("a434"),a("a9e3"),a("4d63"),a("ac1f"),a("25f0"),a("2532"),a("5319"),a("ade3")),i=a("5530"),l=(a("96cf"),a("1da1")),r=a("31e0"),s=a("3eca"),o=a("6e84"),u=a("2387"),c=a("a9e4"),m={props:{PositionID:{type:String,default:""},moduleIndex:{type:Number,default:0},NowEditFormulaData:{type:Object,default:null},curSubFormulaAddProperty:{type:Object,default:null},curEditSubFormulaData:{type:Object,default:null},pageTitle:{type:String,default:""},pageLabel:{type:String,default:"当前物料类型"},PositionType:{type:String,default:""}},components:{LRWidthDragAutoChangeComp:o.a,FormulaPanelElementSelectDialog:c.a,TipsSpanButton:u.a},data:function(){return{PropertyList:null,FormulaData:null,selectVisible:!1,ArithmeticOperatorList:[{label:"+",isMini:!0,value:"+",num:0},{label:"-",isMini:!0,value:"-",num:0},{label:"×",isMini:!0,value:"*",num:0},{label:"÷",isMini:!0,value:"/",num:0},{label:"(",isMini:!1,value:"(",num:0},{label:")",isMini:!1,value:")",num:0},{label:"取余",isMini:!1,value:"%",num:0},{label:"向上取整",isMini:!1,value:"Ceiling()",num:-1},{label:"向下取整",isMini:!1,value:"Floor()",num:-1},{label:"最大值",isMini:!1,value:"Max()",num:-1},{label:"最小值",isMini:!1,value:"Min()",num:-1}],CalculateRes:"",isloading:!1}},computed:{selectedElementIDs:function(){return this.FormulaData&&this.FormulaData.PropertyList&&Array.isArray(this.FormulaData.PropertyList)?this.FormulaData.PropertyList.map((function(t){return t.StoredContent})):[]},haveInputElementList:function(){var t=this;return this.FormulaData&&this.FormulaData.PropertyList&&Array.isArray(this.FormulaData.PropertyList)&&this.FormulaData.Content.length>0?this.FormulaData.PropertyList.filter((function(e){return t.FormulaData.Content.includes(e.DisplayContent)})):[]},watchContent:function(){return this.FormulaData?this.FormulaData.Content:""},isSubFormula:function(){return 2===this.moduleIndex},subFromulaDialogTitle:function(){return this.isSubFormula&&this.curSubFormulaAddProperty?"当前设置子公式：".concat(this.curSubFormulaAddProperty.DisplayContent.replace(/\[|\]/g,"")):""}},methods:{initData:function(){var t=this;return Object(l.a)(regeneratorRuntime.mark((function e(){var a,l,o,u,c,m;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.isloading){e.next=2;break}return e.abrupt("return");case 2:return t.isloading=!0,t.isSubFormula?(t.curEditSubFormulaData&&(l=Object(i.a)({},t.curEditSubFormulaData),o=s.c.getPropIDsObj(t.curEditSubFormulaData)),t.curSubFormulaAddProperty&&(o=s.c.getPropIDsObj(t.curSubFormulaAddProperty),l=Object(i.a)({},o,{UseModule:t.moduleIndex})),o.UseModule=t.moduleIndex):t.NowEditFormulaData?l=Object(i.a)({},t.NowEditFormulaData):(u={},Object(n.a)(u,t.PositionType,t.PositionID),Object(n.a)(u,"UseModule",t.moduleIndex),l=u),c=t.isSubFormula?l:(a={},Object(n.a)(a,t.PositionType,t.PositionID),Object(n.a)(a,"UseModule",t.moduleIndex),a),t.FormulaData=new r.b(l),e.next=8,s.c.getPropertyList(c);case 8:m=e.sent,t.isloading=!1,m&&(t.PropertyList=m,t.initPropertyListReplaceHelper());case 11:case"end":return e.stop()}}),e)})))()},onGoBackClick:function(){this.$emit("goback")},initPropertyListReplaceHelper:function(){var t=this;0!==this.FormulaData.PropertyList.length&&(this.FormulaData.PropertyList=this.FormulaData.PropertyList.map((function(e){var a=s.c.getPerfectPropertyByImperfectProperty(e,t.PropertyList);return a?Object(i.a)({},a,{DefaultValue:e.DefaultValue}):null})).filter((function(t){return t})))},onElementAddClick:function(){this.selectVisible=!0},onElementSelect:function(t){this.FormulaData&&t&&this.FormulaData.PropertyList.push(t)},deleteElement:function(t,e){if(this.FormulaData&&(e||0===e)){this.FormulaData.PropertyList.splice(e,1);var a=t.DisplayContent.replace("[","").replace("]",""),n=new RegExp("\\[".concat(a,"\\]"),"g");this.FormulaData.Content=this.FormulaData.Content.replace(n,"")}},joinElement:function(t){t&&t.DisplayContent&&this.insertVariable(t.DisplayContent)},insertVariable:function(t){var e=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return Object(l.a)(regeneratorRuntime.mark((function n(){var i,l,r;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(i=document.querySelector(".mp-erp-common-comps-formula-set-panel-comp-right-content-wrap .el-textarea__inner")){n.next=4;break}return e.messageBox.failSingle("获取公式输入对象失败"),n.abrupt("return");case 4:if(!i.selectionStart&&0!==i.selectionStart){n.next=14;break}return l=i.selectionStart,r=i.selectionEnd,e.FormulaData.Content=i.value.substring(0,l)+t+i.value.substring(r,i.value.length),n.next=10,e.$nextTick();case 10:i.focus(),i.setSelectionRange(r+t.length+a,r+t.length+a),n.next=15;break;case 14:e.FormulaData.Content=t;case 15:case"end":return n.stop()}}),n)})))()},onArithmeticOperatorClick:function(t){t&&this.insertVariable(t.value,t.num||0)},submitSave:function(t){var e=this;return Object(l.a)(regeneratorRuntime.mark((function a(){var n,i,l,r;return regeneratorRuntime.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,e.api.getFormulaSave(t).catch((function(){}));case 2:(n=a.sent)&&200===n.status&&1e3===n.data.Status&&(i=!!t.ID,l=i?"编辑成功":"添加成功",r=function(){e.$emit("successSubmit",[i,t,n.data.Data]),e.onGoBackClick()},e.messageBox.successSingle(l,r,r));case 4:case"end":return a.stop()}}),a)})))()},useCalculate:function(t){var e=this;return Object(l.a)(regeneratorRuntime.mark((function a(){var n;return regeneratorRuntime.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,e.api.getFormulaCalculate(t).catch((function(){}));case 2:(n=a.sent)&&200===n.status&&1e3===n.data.Status&&(e.CalculateRes=n.data.Data);case 4:case"end":return a.stop()}}),a)})))()},onSubmitClick:function(){r.b.checkSubmit(this.FormulaData)&&this.submitSave(this.FormulaData)},onCalculateClick:function(){r.b.checkCalculate(this.FormulaData)&&(this.CalculateRes="",this.useCalculate(this.FormulaData))},onCalculateInput:function(){this.CalculateRes=""}},watch:{watchContent:function(){this.CalculateRes=""}},mounted:function(){this.initData()}},p=(a("ef80"),a("2877")),f=Object(p.a)(m,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return t.PropertyList&&t.FormulaData?a("section",{staticClass:"mp-erp-common-comps-formula-set-panel-comp--wrap"},[a("header",[a("span",[t._v(t._s(t.pageLabel)+"：")]),a("span",[t._v(t._s(t.pageTitle))]),a("div",[a("div",[a("span",[t._v("公式名称：")]),a("el-input",{staticStyle:{width:"250px"},attrs:{size:"small",maxlength:"6","show-word-limit":""},model:{value:t.FormulaData.Name,callback:function(e){t.$set(t.FormulaData,"Name","string"==typeof e?e.trim():e)},expression:"FormulaData.Name"}})],1),a("div",[a("span",[t._v("结果单位：")]),a("el-input",{staticStyle:{width:"100px"},attrs:{size:"small",maxlength:"4","show-word-limit":""},model:{value:t.FormulaData.Unit,callback:function(e){t.$set(t.FormulaData,"Unit","string"==typeof e?e.trim():e)},expression:"FormulaData.Unit"}})],1)])]),a("main",[a("LRWidthDragAutoChangeComp",{attrs:{leftWidth:"45%"},scopedSlots:t._u([{key:"left",fn:function(){return[a("section",{staticClass:"mp-erp-common-comps-formula-set-panel-comp-left-content-wrap"},[a("header",[a("p",{staticClass:"btn-box"},[a("el-button",{attrs:{type:"primary",size:"small"},on:{click:t.onElementAddClick}},[t._v("+添加元素")])],1),a("p",{staticClass:"tips-box"},[a("i",{staticClass:"el-icon-warning"}),t._v(" 注：当为空值时设置的值指当某一界面元素被禁用/隐藏或者客户未选择未填写任何值时，以此值参与运算")])]),a("main",[a("p",{staticClass:"module-title"},[t._v("已选元素概览")]),a("ul",t._l(t.FormulaData.PropertyList,(function(e,n){return a("li",{key:e.StoredContent+""+n},[e.TipsContent?a("TipsSpanButton",{staticClass:"name",attrs:{text:e.DisplayContent,tipContent:e.TipsContent}}):a("span",{staticClass:"name"},[t._v(t._s(e.DisplayContent))]),a("span",{staticClass:"default"},[a("i",[t._v("空值设为：")]),a("el-input",{attrs:{size:"small"},model:{value:e.DefaultValue,callback:function(a){t.$set(e,"DefaultValue","string"==typeof a?a.trim():a)},expression:"it.DefaultValue"}}),a("i",[t._v(" "+t._s(e.Unit))])],1),a("span",{staticClass:"del",on:{click:function(a){return t.deleteElement(e,n)}}},[a("i"),t._v("删除")]),a("span",{staticClass:"join blue-span",on:{click:function(a){return t.joinElement(e)}}},[t._v("加入 "),a("i",{staticClass:"el-icon-d-arrow-right"})])],1)})),0)])])]},proxy:!0},{key:"right",fn:function(){return[a("section",{staticClass:"mp-erp-common-comps-formula-set-panel-comp-right-content-wrap"},[a("header",[a("p",{staticClass:"module-title"},[t._v("公式")])]),a("main",[a("el-input",{attrs:{type:"textarea",autosize:{minRows:10,maxRows:100}},model:{value:t.FormulaData.Content,callback:function(e){t.$set(t.FormulaData,"Content","string"==typeof e?e.trim():e)},expression:"FormulaData.Content"}}),a("div",{staticClass:"ctrl-box"},t._l(t.ArithmeticOperatorList,(function(e){return a("span",{key:e.value,class:e.isMini?"mini":"",on:{click:function(a){return t.onArithmeticOperatorClick(e)}}},[t._v(t._s(e.label))])})),0),a("p",{staticClass:"intro"},[a("span",[t._v("公式说明：")]),a("el-input",{attrs:{size:"small",maxlength:"50","show-word-limit":""},model:{value:t.FormulaData.Remark,callback:function(e){t.$set(t.FormulaData,"Remark","string"==typeof e?e.trim():e)},expression:"FormulaData.Remark"}})],1),a("p",{staticClass:"module-title"},[t._v("试算")]),a("div",{staticClass:"test-box"},[a("div",t._l(t.FormulaData.PropertyList,(function(e){return a("div",{key:e.DisplayContent},[a("span",{attrs:{title:e.DisplayContent}},[t._v(t._s(e.DisplayContent)+"：")]),a("el-input",{attrs:{size:"small",disabled:!t.FormulaData.Content.includes(e.DisplayContent)},on:{input:t.onCalculateInput},model:{value:e.CalculateValue,callback:function(a){t.$set(e,"CalculateValue","string"==typeof a?a.trim():a)},expression:"it.CalculateValue"}}),a("span",[t._v(t._s(e.Unit))])],1)})),0),a("p",[a("span",{staticClass:"blue-span",class:t.FormulaData&&t.FormulaData.Content?"":"disabled",on:{click:t.onCalculateClick}},[t._v("测试运算")]),t.CalculateRes||0===t.CalculateRes?a("span",[t._v("测试运算结果："),a("i",{staticClass:"is-pink"},[t._v(t._s(t.CalculateRes))])]):t._e()])])],1)])]},proxy:!0}],null,!1,748847638)}),a("FormulaPanelElementSelectDialog",{attrs:{useType:"formula",DialogTitle:t.subFromulaDialogTitle,visible:t.selectVisible,list:t.PropertyList,selectedElementIDs:t.selectedElementIDs},on:{"update:visible":function(e){t.selectVisible=e},submit:t.onElementSelect}})],1),a("footer",[a("el-button",{attrs:{type:"primary"},on:{click:t.onSubmitClick}},[t._v("保存")]),a("el-button",{staticClass:"go-back",on:{click:t.onGoBackClick}},[t._v("返回")])],1)]):t._e()}),[],!1,null,null,null);e.a=f.exports},ef80:function(t,e,a){"use strict";var n=a("4aee");a.n(n).a}}]);