(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-55120263"],{"61c8":function(t,e,n){"use strict";n.r(e);var a=(n("b0c0"),n("ac1f"),n("5319"),n("5530")),o=n("c362"),i=n("2f62"),r={components:{CommonElementSetPageComp:o.a},data:function(){return{PositionID:"",craftName:""}},computed:Object(a.a)({},Object(i.e)("basicSet",["craftFetchData"]),{fetchData:{get:function(){return this.craftFetchData},set:function(t){this.$store.commit("basicSet/setCraftFetchData",t)}}}),methods:{getPositionID:function(){if(this.$route.params){var t=this.$route.params,e=t.id,n=t.name;e&&n&&(this.PositionID=e,this.craftName=n)}},onGoBackClick:function(){this.$router.replace("/CraftManageList")},onElementSave:function(t){var e=t.isEdit,n=t.data;this.$store.commit("basicSet/setCraftElementChange",[e,n,this.PositionID])},onElementRemove:function(t){this.$store.commit("basicSet/setCraftElementRemove",[t,this.PositionID])},onElementGroupSave:function(){this.fetchData=!0},onElementGroupRemove:function(){this.fetchData=!0},setFetchData:function(){this.fetchData=!0}},mounted:function(){this.getPositionID()},activated:function(){this.fetchData=!1}},s=(n("ccd1"),n("2877")),u=Object(s.a)(r,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("section",{staticClass:"mp-erp-craft-list-page-element-set-comp-wrap"},[n("header",[n("span",[t._v("当前工艺：")]),n("span",[t._v(t._s(t.craftName))])]),t.PositionID?n("CommonElementSetPageComp",{attrs:{PositionID:t.PositionID},on:{elementSave:t.onElementSave,elementRemove:t.onElementRemove,elementGroupSave:t.onElementGroupSave,elementGroupRemove:t.onElementGroupRemove,copyGroupSuccess:t.setFetchData}}):t._e(),n("footer",[n("el-button",{on:{click:t.onGoBackClick}},[t._v("返回")])],1)],1)}),[],!1,null,null,null);e.default=u.exports},"65dc":function(t,e,n){},c362:function(t,e,n){"use strict";var a=(n("4de4"),n("7db0"),n("c740"),n("4160"),n("caad"),n("d81d"),n("a434"),n("2532"),n("159b"),n("5530")),o=n("2909"),i=(n("96cf"),n("1da1")),r=n("05f6"),s={props:{PositionID:{type:String,default:""},GroupID:{type:String,default:""},showGroup:{type:Boolean,default:!0},canRemove:{type:Function,default:null}},data:function(){return{ElementDataList:[],ElementGroupDataList:[],isLoadingElement:!1,isLoadingGroup:!1}},components:{CommonElementSetComp:r.a},methods:{handleEditSubmitSuccess:function(t){var e=t.saveType,n=t.editData,a=t.ID,o=n,i="编辑"===e;if(i){if(i){var r=this.ElementDataList.findIndex((function(t){return t.ID===o.ID}));r>=0&&this.ElementDataList.splice(r,1,o)}}else o.ID=a,this.ElementDataList.push(o);this.$emit("elementSave",{isEdit:i,data:o})},onElementRemove:function(t){var e=this;return Object(i.a)(regeneratorRuntime.mark((function n(){var a,i,r;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!e.canRemove||e.canRemove(t)){n.next=3;break}return n.abrupt("return");case 3:if(!(e.ElementGroupDataList&&e.ElementGroupDataList.length>0)){n.next=10;break}if(a=[],e.ElementGroupDataList.forEach((function(t){return a.push.apply(a,Object(o.a)(t.ElementList))})),!a.find((function(e){return e.ID===t}))){n.next=10;break}return e.messageBox.failSingleError("删除失败","该元素在界面元素组中已使用"),n.abrupt("return");case 10:return n.next=12,e.api.getElementRemove(t).catch((function(){}));case 12:(i=n.sent)&&200===i.status&&1e3===i.data.Status&&(r=function(){e.ElementDataList=e.ElementDataList.filter((function(e){return e.ID!==t})),e.$emit("elementRemove",t)},e.messageBox.successSingle("删除成功",r,r));case 14:case"end":return n.stop()}}),n)})))()},getElementList:function(){var t=this;return Object(i.a)(regeneratorRuntime.mark((function e(){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.isLoadingElement=!0,e.next=3,t.api.getElementList({groupID:t.GroupID,positionID:t.PositionID}).catch((function(){}));case 3:(n=e.sent)&&200===n.status&&1e3===n.data.Status&&(t.ElementDataList=n.data.Data),t.isLoadingElement=!1;case 6:case"end":return e.stop()}}),e)})))()},handleGroupSaveSuccess:function(t){var e=this,n=t.saveType,a=t.editData,o=t.ID,i=a,r=function(){var t=i.ElementList.map((function(t){return t.ID}));e.ElementDataList.forEach((function(e){var n=e;t.includes(e.ID)?!n||n.Group&&n.Group.ID===o||(n.Group={ID:o,Name:i.Name}):n.Group&&n.Group.ID===o&&(n.Group=null)}))};if("添加"===n)i.ID=o,this.ElementGroupDataList.push(i),r(),this.$emit("elementGroupSave",{isEdit:!1,data:i});else if("编辑"===n){var s=this.ElementGroupDataList.findIndex((function(t){return t.ID===i.ID}));s>=0&&(this.ElementGroupDataList.splice(s,1,i),r(),this.$emit("elementGroupSave",{isEdit:!0,data:i}))}},onElementGroupRemove:function(t){var e=this;return Object(i.a)(regeneratorRuntime.mark((function n(){var a,o;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,e.api.getElementGroupRemove(t).catch((function(){}));case 2:(a=n.sent)&&200===a.status&&1e3===a.data.Status&&(o=function(){e.ElementGroupDataList.find((function(e){return e.ID===t})).ElementList.forEach((function(t){var n=e.ElementDataList.find((function(e){return e.ID===t.ID}));n&&(n.Group=null)})),e.ElementGroupDataList=e.ElementGroupDataList.filter((function(e){return e.ID!==t})),e.$emit("elementGroupRemove",t)},e.messageBox.successSingle("删除成功",o,o));case 4:case"end":return n.stop()}}),n)})))()},getElementGroupList:function(){var t=this;return Object(i.a)(regeneratorRuntime.mark((function e(){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.isLoadingGroup=!0,e.next=3,t.api.getElementGroupList(t.PositionID).catch((function(){}));case 3:(n=e.sent)&&200===n.status&&1e3===n.data.Status&&(t.ElementGroupDataList=n.data.Data),t.isLoadingGroup=!1;case 6:case"end":return e.stop()}}),e)})))()},handleSortSuccess:function(t){var e=t.ID,n=t.ElementList,o=this.ElementGroupDataList.find((function(t){return t.ID===e}));o&&(o.ElementList=o.ElementList.map((function(t){var e=n.find((function(e){return e.ID===t.ID}));return e?Object(a.a)({},t,{Index:e.Index}):Object(a.a)({},t)})))},fetchData:function(){this.getElementList(),this.showGroup&&this.getElementGroupList(),this.$emit("copyGroupSuccess")}},mounted:function(){this.getElementList(),this.showGroup&&this.getElementGroupList()}},u=n("2877"),c=Object(u.a)(s,(function(){var t=this,e=t.$createElement;return(t._self._c||e)("CommonElementSetComp",{attrs:{ElementDataList:t.ElementDataList,ElementGroupDataList:t.ElementGroupDataList,isLoadingElement:t.isLoadingElement,isLoadingGroup:t.isLoadingGroup,PositionID:t.PositionID,showGroup:t.showGroup},on:{saveElement:t.handleEditSubmitSuccess,removeElement:t.onElementRemove,saveElementGroup:t.handleGroupSaveSuccess,removeElementGroup:t.onElementGroupRemove,sortGroupElementList:t.handleSortSuccess,copyGroupSuccess:t.fetchData}})}),[],!1,null,null,null);e.a=c.exports},ccd1:function(t,e,n){"use strict";var a=n("65dc");n.n(a).a}}]);