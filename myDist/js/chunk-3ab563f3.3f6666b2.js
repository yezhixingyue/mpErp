(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-3ab563f3"],{"2df4":function(e,t,i){},3632:function(e,t,i){},"38cf":function(e,t,i){i("23e7")({target:"String",proto:!0},{repeat:i("1148")})},"468e":function(e,t,i){"use strict";var n=i("4aae");i.n(n).a},"4aae":function(e,t,i){},9130:function(e,t,i){"use strict";i.r(t);var n=(i("7db0"),i("4160"),i("a15b"),i("d81d"),i("a434"),i("ac1f"),i("38cf"),i("5319"),i("159b"),i("2909")),a=(i("96cf"),i("1da1")),s=i("3835"),l=i("5530"),c=i("2f62"),o=(i("99af"),i("caad"),i("fb6a"),i("d3b7"),i("25f0"),i("2532"),i("ad32")),r={props:{Element:{type:Object,default:null},value:{type:Object,default:null}},model:{prop:"value",event:"change"},computed:{NumberOptions:function(){if(1===this.Element.Type){if(this.Element.NumbericAttribute.InputContent)return this.$utils.getNumberValueList(this.Element.NumbericAttribute.InputContent);if(!this.Element.NumbericAttribute.InputContent&&(this.Element.NumbericAttribute.CheckedValue||0===this.Element.NumbericAttribute.CheckedValue))return[this.Element.NumbericAttribute.CheckedValue]}return[]},checkList:{get:function(){return this.value.checkList},set:function(e){var t=Object(l.a)({},this.value);t.checkList=e,this.$emit("change",t)}},customValue:{get:function(){return this.value.customValue},set:function(e){var t=Object(l.a)({},this.value);t.customValue=e,this.$emit("change",t)}},customChecked:{get:function(){return this.value.customChecked},set:function(e){var t=Object(l.a)({},this.value);t.customChecked=e,this.$emit("change",t)}}},data:function(){return{isOpen:!0}}},u=(i("d225"),i("2877")),m=Object(u.a)(r,(function(){var e=this,t=e.$createElement,i=e._self._c||t;return e.Element&&e.value?i("section",{staticClass:"mp-erp-material-mass-production-dialog-single-element-show-comp-wrap"},[i("header",[i("span",{staticClass:"title"},[e._v(e._s(e.Element.Name))]),i("span",{staticClass:"fold-box",class:e.isOpen?"":"unfold",on:{click:function(t){e.isOpen=!e.isOpen}}},[i("em",[e._v(e._s(e.isOpen?"收起":"展开"))]),i("i",{staticClass:"el-icon-arrow-up"})])]),i("main",{directives:[{name:"show",rawName:"v-show",value:e.isOpen,expression:"isOpen"}]},[1===e.Element.Type?[i("el-checkbox-group",{model:{value:e.checkList,callback:function(t){e.checkList=t},expression:"checkList"}},e._l(e.NumberOptions,(function(t){return i("el-checkbox",{key:t,attrs:{label:+t}},[e._v(e._s(t))])})),1),e.Element.NumbericAttribute.Allow?i("div",{staticClass:"custom-box"},[i("el-checkbox",{model:{value:e.customChecked,callback:function(t){e.customChecked=t},expression:"customChecked"}},[e._v("自定义")]),i("el-input",{directives:[{name:"show",rawName:"v-show",value:e.customChecked,expression:"customChecked"}],attrs:{size:"mini"},model:{value:e.customValue,callback:function(t){e.customValue="string"==typeof t?t.trim():t},expression:"customValue"}})],1):e._e()]:e._e(),2===e.Element.Type?[i("el-checkbox-group",{model:{value:e.checkList,callback:function(t){e.checkList=t},expression:"checkList"}},e._l(e.Element.OptionAttribute.OptionList,(function(t){return i("el-checkbox",{key:t.ID,attrs:{label:t.ID,title:t.Name}},[e._v(e._s(t.Name))])})),1),0===e.Element.OptionAttribute.OptionList.length?i("span",{staticClass:"is-font-size-12 is-gray"},[e._v("该元素未设置选择项")]):e._e()]:e._e(),3===e.Element.Type?[i("el-checkbox-group",{model:{value:e.checkList,callback:function(t){e.checkList=t},expression:"checkList"}},[i("el-checkbox",{attrs:{label:e.Element.SwitchAttribute.OpenValue,title:e.Element.SwitchAttribute.Words}},[e._v("开")]),i("el-checkbox",{attrs:{label:e.Element.SwitchAttribute.CloseValue,title:e.Element.SwitchAttribute.Words}},[e._v("关")])],1)]:e._e()],2)]):e._e()}),[],!1,null,null,null).exports,p={props:{visible:{type:Boolean,default:!1},curMaterialType:{type:Object,default:null}},components:{CommonDialogComp:o.a,SingleElementComp:m},data:function(){return{title:"生成规则",list:[]}},methods:{onAddSubmit:function(){this.setSubmit("append")},onAfreshSubmit:function(){this.setSubmit("refresh")},checkValueChecker:function(){var e=this,t=[];if(this.list.forEach((function(e){0!==e.checkList.length||e.customChecked&&e.customValue||t.push(e.Element.Name)})),t.length>0)return this.messageBox.failSingleError("保存失败！","".concat(t.join("、"),"未选中有效内容")),!1;var i=this.list.find((function(t){return!(!t.customChecked||!t.customValue||e.$utils.getValueIsOrNotNumber(t.customValue,1===t.Element.Type&&t.Element.NumbericAttribute.AllowDecimal))}));return i?(this.messageBox.failSingleError("保存失败！","".concat(i.Element.Name,"自定义值无效，请检查是否为数字类型或是否限定为整数类型")),!1):(i=this.list.find((function(e){return!!(1===e.Element.Type&&e.customChecked&&e.customValue&&e.checkList.includes(+e.customValue))})))?(this.messageBox.failSingleError("保存失败！","".concat(i.Element.Name,"自定义值重复")),!1):!(i=this.list.find((function(t){if(1===t.Element.Type&&t.customChecked&&t.customValue){var i=t.Element.NumbericAttribute,n=i.SectionList,a=i.InputContent;if(n&&Array.isArray(n)&&n.length>0){if(e.$utils.getNumberValueList(a).includes("".concat(t.customValue)))return!1;for(var s=!1,l=0;l<n.length;l+=1){var c=n[l],o=c.MinValue,r=c.MaxValue,u=c.IsGeneralValue,m=c.Increment;if(+t.customValue>o&&(+t.customValue<=r||-1===r)){if(s=!0,!u&&(+t.customValue-o)%m!=0)return!0;if(u)return!0}}if(!s)return!0}}return!1})))||(this.messageBox.failSingleError("保存失败！","".concat(i.Element.Name,"自定义值不合法，请检查其分段控制")),!1)},getArrayFromCheckObj:function(e){var t=e.Element,i=e.checkList,a=e.customChecked,s=e.customValue,l=t.ID,c=t.Type,o=t.Unit,r=t.OptionAttribute,u=t.SwitchAttribute,m=Object(n.a)(i);return a&&s&&m.push(s),m.map((function(e){var t=e;if(1===c)t=o?"".concat(t).concat(o):t;else if(2===c){var i=r.OptionList.find((function(t){return t.ID===e}));i&&(t=i.Name)}else if(3===c){var n=u.OpenValue,a=u.CloseValue;e===n&&(t="开"),e===a&&(t="关")}return{First:l,Second:e,Third:t}}))},setSubmit:function(e){var t=this;if(this.checkValueChecker()){var i=this.list.map((function(e){return t.getArrayFromCheckObj(e)})),n=[];1===i.length?i[0].forEach((function(e){n.push([e])})):n=this.$utils.calcDescartes(i);var a=n.map((function(e){return{First:"",Second:e,key:Math.random().toString(32).slice(-8),repeat:!1}}));this.$emit("submit",{type:e,ElementList:a}),this.onCancle()}},onCancle:function(){this.$emit("update:visible",!1)},onOpen:function(){this.$nextTick(this.initEditData)},onClosed:function(){this.$emit("close"),this.list=[]},initEditData:function(){var e=this;this.curMaterialType&&this.curMaterialType.ElementList.forEach((function(t){var i={checkList:[],customChecked:!1,customValue:"",Element:t};e.list.push(i)}))}}},h={name:"MaterialMassProductionPage",components:{MaterialListMassProductionDialog:(i("93ac"),Object(u.a)(p,(function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("CommonDialogComp",{staticClass:"mp-erp-comps-material-size-save-dialog-comp-wrap",attrs:{width:"800px",top:"15vh",title:e.title,visible:e.visible,submitText:"追加生成",showDanger:""},on:{"update:visible":function(t){e.visible=t},submit:e.onAddSubmit,danger:e.onAfreshSubmit,cancle:e.onCancle,open:e.onOpen,closed:e.onClosed}},[e.curMaterialType?e._l(e.curMaterialType.ElementList,(function(t,n){return i("SingleElementComp",{key:t.ID,attrs:{Element:t},model:{value:e.list[n],callback:function(t){e.$set(e.list,n,t)},expression:"list[i]"}})})):e._e()],2)}),[],!1,null,null,null)).exports},computed:Object(l.a)({},Object(c.e)("basicSet",["MaterialTypeList"])),data:function(){return{curMaterialType:null,visible:!1,ElementList:[]}},methods:{getInitData:function(){if(this.MaterialTypeList){var e=this.$route.params.type,t=this.MaterialTypeList.find((function(t){return t.ID===e}));t?this.curMaterialType=t:this.$message.error("未获取到物料类型信息，请刷新重试")}},getItemName:function(e){var t=e.Second;return t&&Array.isArray(t)&&0!==t.length?t.map((function(e){return e.Third})).join(" "):""},onItemRemove:function(e){var t=this.ElementList.splice(e,1);Object(s.a)(t,1)[0].repeat&&(this.ElementList=this.ElementList.map((function(e){return Object(l.a)({},e,{repeat:!1})})),this.itemRepeatChecker())},getMaterialSave:function(e){var t=this;return Object(a.a)(regeneratorRuntime.mark((function i(){var n,a;return regeneratorRuntime.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,t.api.getMaterialSave(e).catch((function(){}));case 2:(n=i.sent)&&200===n.status&&1e3===n.data.Status&&(a=function(){t.onGoback("?init=true")},t.messageBox.successSingle("保存成功",a,a));case 4:case"end":return i.stop()}}),i)})))()},onSubmit:function(){if(this.ElementList.find((function(e){return e.repeat})))this.messageBox.failSingleError("操作失败","存在重复项，请先清除");else{var e={TypeID:this.curMaterialType.ID,ElementList:this.ElementList.map((function(e){return{First:"",Second:e.Second.map((function(e){return{First:e.First,Second:e.Second}}))}}))};this.getMaterialSave(e)}},onGoback:function(e){this.ElementList=[],this.curMaterialType=null,this.visible=!1,this.$router.replace("/MaterialList".concat(e))},onCreateClick:function(){this.visible=!0},itemRepeatChecker:function(){var e=this;0!==this.ElementList.length&&this.ElementList.forEach((function(t,i){var n=t.Second;t.repeat||e.ElementList.forEach((function(e,a){if(a>i){for(var s=!0,l=0;l<n.length;l+=1){var c=n[l],o=e.Second[l];if(c.Second!==o.Second&&c.First===o.First)return void(s=!1)}if(s){var r=e;t.repeat=!0,r.repeat=!0}}}))}))},onDialogSubmit:function(e){var t,i=e.type,a=e.ElementList;"append"===i&&((t=this.ElementList).push.apply(t,Object(n.a)(a)),this.ElementList.length>a.length&&(this.ElementList=this.ElementList.map((function(e){return Object(l.a)({},e,{repeat:!1})})),this.itemRepeatChecker())),"refresh"===i&&(this.ElementList=a)}},mounted:function(){this.getInitData()},activated:function(){this.getInitData()}},f=(i("b337"),Object(u.a)(h,(function(){var e=this,t=e.$createElement,i=e._self._c||t;return e.curMaterialType?i("section",{staticClass:"mp-erp-material-mass-production-page-wrap"},[i("header",[i("p",[i("span",[e._v("当前物料类型：")]),i("span",[e._v(e._s(e.curMaterialType.Name))])]),i("el-button",{attrs:{type:"primary"},on:{click:e.onCreateClick}},[e._v("生成规则")])],1),i("main",[i("MaterialListMassProductionDialog",{attrs:{visible:e.visible,curMaterialType:e.curMaterialType},on:{"update:visible":function(t){e.visible=t},submit:e.onDialogSubmit}}),i("ul",{staticClass:"list"},e._l(e.ElementList,(function(t,n){return i("li",{key:t.key,staticClass:"list-item",class:t.repeat?"repeat":"",attrs:{title:t.repeat?"标红为重复项，请删除至一项":""}},[i("span",[e._v(e._s(e.getItemName(t)))]),i("div",{on:{click:function(t){return e.onItemRemove(n)}}},[i("i"),i("span",[e._v("删除")])])])})),0)],1),i("footer",[i("el-button",{staticClass:"blue-full-color-btn-styles is-blue-button",attrs:{type:"primary",disabled:0===e.ElementList.length},on:{click:e.onSubmit}},[e._v("保存")]),i("el-button",{staticClass:"goback",on:{click:function(t){return e.onGoback("")}}},[e._v("返回")])],1)]):e._e()}),[],!1,null,null,null));t.default=f.exports},"93ac":function(e,t,i){"use strict";var n=i("3632");i.n(n).a},ad32:function(e,t,i){"use strict";var n={model:{prop:"value",event:"change"},props:{visible:{type:Boolean,default:!1},title:{type:String,default:"提示"},width:{default:"30%"},top:{type:String,default:"15vh"},showSubmit:{type:Boolean,default:!0},submitText:{type:String,default:"保存"},dangerText:{type:String,default:"重新生成"},cancelText:{type:String,default:"取消"},disabled:{type:Boolean,default:!1},showDanger:{type:Boolean,default:!1},loading:{type:Boolean,default:!1}},computed:{dialogVisible:{get:function(){return this.visible},set:function(e){this.$emit("update:visible",e)}}},data:function(){return{checkList:[]}},methods:{onCancleClick:function(){this.$emit("cancle")},onSubmitClick:function(e){this.dialogVisible&&("BUTTON"===e.target.nodeName?e.target.blur():"BUTTON"===e.target.parentNode.nodeName&&e.target.parentNode.blur(),this.$emit("submit"))},onDangerClick:function(){this.$emit("danger")},onOpen:function(){this.$emit("open")},onOpened:function(){this.$emit("opened")},onClose:function(){this.$emit("close")},onClosed:function(){this.$emit("closed")}}},a=(i("468e"),i("2877")),s=Object(a.a)(n,(function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("el-dialog",{directives:[{name:"dialogDrag",rawName:"v-dialogDrag"}],staticClass:"mp-img-style-header mp-erp-common-dialog-comp-wrap",attrs:{title:e.title,visible:e.dialogVisible,"close-on-click-modal":!1,width:e.width,top:e.top,modal:!1,"before-close":e.onCancleClick},on:{"update:visible":function(t){e.dialogVisible=t},open:e.onOpen,opened:e.onOpened,close:e.onClose,closed:e.onClosed}},[e._t("default"),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e.$slots["foot-tip"]?i("div",[e._t("foot-tip")],2):e._e(),i("p",[e.showSubmit?i("el-button",{attrs:{type:"primary",loading:e.loading,disabled:e.disabled},on:{click:e.onSubmitClick}},[e._v(e._s(e.loading?"加载中":e.submitText))]):e._e(),e.showDanger?i("el-button",{attrs:{type:"danger"},on:{click:e.onDangerClick}},[e._v(e._s(e.dangerText))]):e._e(),i("el-button",{on:{click:e.onCancleClick}},[e._v(e._s(e.cancelText))])],1)])],2)}),[],!1,null,null,null);t.a=s.exports},b337:function(e,t,i){"use strict";var n=i("2df4");i.n(n).a},d225:function(e,t,i){"use strict";var n=i("e30b");i.n(n).a},e30b:function(e,t,i){}}]);