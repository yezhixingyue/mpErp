(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-569d2dd8"],{"2af0":function(t,e,i){"use strict";i("4de4"),i("7db0"),i("c740"),i("caad"),i("d81d"),i("a434"),i("2532");var a=i("3835"),o=i("2909"),n=i("5530"),r=i("aa47"),l=i("c117"),s=i("2f62");e.a={data:function(){return{h:0,sortItem:null,tableKey:this.$utils.getRandomRangeId(8),notify:null,hideColLabelList:[],localShowLabelList:[]}},watch:{h:function(t){this.h=t;var e=document.getElementsByClassName("el-table")[0];e&&(e.style.maxHeight="".concat(t,"px"))},hideColLabelList:function(){var t=this;this.tableColData=this.tableColData.map((function(e){var i=Object(n.a)({},e);return t.hideColLabelList.includes(e.label)?i.show=!1:i.show=!0,i}))},isLeftCollapse:function(t){var e=this;setTimeout((function(){e.setHeightByDebounce()}),t?700:450)}},computed:Object(n.a)({},Object(s.e)("layout",["isLeftCollapse"]),{colLabels:function(){return this.tableColData?this.tableColData.map((function(t){return t.label})):[]},curShowColTableData:function(){return this.tableColData?this.tableColData.filter((function(t){return t.show})):[]}}),methods:{getHeight:function(t,e){var i=document.querySelector("#app > section > main");if(!i)return 600;var a=t?document.querySelector(t):null;return(a?i.offsetHeight-a.offsetHeight:i.offsetHeight)-e},initHeightAuto:function(){var t=this;this.$nextTick((function(){return t.setHeightByDebounce()})),window.addEventListener("resize",this.setHeightByDebounce)},removeHeightAuto:function(){window.removeEventListener("resize",this.setHeightByDebounce)},onHeaderDragend:function(t,e,i){var a=this;if(this.tableColData){var o=this.tableColData.find((function(t){return t.label===i.label}));if(o&&(o.width&&(o.width="".concat(t,"px")),o.minWidth&&(o.minWidth="".concat(t,"px"))),this.sortItem){try{this.sortItem.destroy()}catch(t){}this.$nextTick((function(){a.commonTableSortMixin()}))}}},commonTableSortMixin:function(){if(this.tableColData){var t=document.querySelector(".el-table__header thead tr"),e={onEnd:this.handleSortEnd};try{this.sortItem=r.a.create(t,e)}catch(t){}}},handleSortEnd:function(t){var e=this,i=t.oldIndex-1,n=t.newIndex-1;if(this.curShowColTableData.length<this.tableColData.length&&this.curShowColTableData[i]){var r=this.curShowColTableData[i].label,l=this.tableColData.findIndex((function(t){return t.label===r}));if(l>=0&&(i=l),n>0){var s=this.curShowColTableData[n-1].label,c=this.tableColData.findIndex((function(t){return t.label===s}));c>=0&&(n=c+1)}}var u=Object(o.a)(this.tableColData),d=u.splice(i,1),h=Object(a.a)(d,1)[0];u.splice(n,0,h),this.tableColData=u,this.tableKey=this.$utils.getRandomRangeId(8),this.$nextTick((function(){e.commonTableSortMixin()}))},handleMountedAndActivated:function(){var t=this;if(this.setHeightByDebounce=Object(l.a)(this.setHeight,30),this.initHeightAuto(),this.commonTableSortMixin(),this.tableName){var e=JSON.parse(localStorage.getItem(this.tableName));e.length>0&&(e=e.filter((function(e){return t.colLabels.includes(e)}))),this.hideColLabelList=e}},handleDestroyAndDeactivated:function(){if(this.removeHeightAuto(),this.sortItem)try{this.sortItem.destroy()}catch(t){}},onInfoClick:function(){var t=this,e=this.$createElement;if(this.tableColData){var i=160;this.$refs.oElTable&&this.$refs.oElTable.$el&&this.$refs.oElTable.$el.offsetTop&&(i=this.$refs.oElTable.$el.offsetTop-17),this.localShowLabelList=this.colLabels.filter((function(e){return!t.hideColLabelList.includes(e)}));var a=function(){t.notify&&t.notify.close()},n=function(e){var i=t.localShowLabelList.findIndex((function(t){return t===e}));i>=0?t.localShowLabelList.splice(i,1):t.localShowLabelList.push(e)},r=e("section",{class:"content-box"},[e("main",[e("el-checkbox-group",{attrs:{value:this.localShowLabelList}},[this.tableColData.map((function(t){return e("el-checkbox",{on:{change:function(){return n(t.label)}},attrs:{label:t.label},key:t.label})}))])]),e("footer",[e("el-button",{on:{click:function(){t.hideColLabelList=t.colLabels.filter((function(e){return!t.localShowLabelList.includes(e)})),t.tableName&&localStorage.setItem(t.tableName,JSON.stringify(t.hideColLabelList)),a()}},attrs:{type:"primary"}},["保存"]),e("el-button",{on:{click:a}},["关闭"]),e("span",{class:"span-title-blue",on:{click:function(){var e,i=t.colLabels.filter((function(e){return!t.localShowLabelList.includes(e)}));(e=t.localShowLabelList).push.apply(e,Object(o.a)(i))}}},["重置"]),e("p",{class:"is-gray"},[e("span",["1. 没有被选中的列将会被隐藏"]),e("span",["2. 列显示隐藏设置会缓存至本地，在不清除缓存或版本更新的情况下，下次打开会自动延续本次设置"]),e("span",["3. 中间列可左右拖动（不被缓存）"])])])]);this.notify=this.$notify({title:"设置列显示",customClass:"mp-erp-table-column-show-setup-wrap",duration:0,message:r,offset:i})}}},mounted:function(){this.handleMountedAndActivated()},beforeDestroy:function(){this.handleDestroyAndDeactivated()},activated:function(){this.handleMountedAndActivated()},deactivated:function(){this.handleDestroyAndDeactivated()}}},3692:function(t,e,i){"use strict";var a=i("394e");i.n(a).a},"394e":function(t,e,i){},"50ed":function(t,e,i){"use strict";var a=i("9f42");i.n(a).a},"9f42":function(t,e,i){},b78c:function(t,e,i){"use strict";i.r(e);var a=(i("99af"),i("4de4"),i("7db0"),i("a15b"),i("d81d"),i("b0c0"),i("ac1f"),i("5319"),i("96cf"),i("1da1")),o=i("5530"),n=i("2f62"),r=i("2af0"),l=i("3eca"),s={props:{dataList:{default:function(){return[]},type:Array},loading:{type:Boolean,default:!1},PropertyList:{default:function(){return[]},type:Array}},computed:{localTableData:function(){var t=this;return this.dataList&&Array.isArray(this.dataList)&&0!==this.dataList.length?this.dataList.map((function(e){return Object(o.a)({},e,{PriorityText:"".concat(e.Priority,"级"),FilterTypeText:1===e.Constraint.FilterType?"满足所有条件":"满足任一条件",FileInfoText:t.getFileInfoText(e.FileList),conditionText:t.getConditionText(e.Constraint.ItemList)})})):[]}},mixins:[r.a],methods:{setHeight:function(){var t=this.getHeight(".mp-erp-product-list-page-product-file-list-page-wrap > header",110);this.h=t},onEditClick:function(t){this.$emit("edit",t)},onRemoveClick:function(t,e){this.$emit("remove",t,e)},getFileInfoText:function(t){return Array.isArray(t)&&0!==t.length?t.map((function(t){var e=t.File,i=t.IsRequired;return"".concat(e.Name).concat(i?"（必须上传）":"")})).join("、"):""},getConditionText:function(t){return l.d.getPropertyConditionText(t,this.PropertyList)||"无"}}},c=(i("3692"),i("2877")),u={name:"ProductFileListPage",data:function(){return{ProductID:"",PartID:"",ProductName:"",titleType:"",curEditData:null,loading:!1}},components:{FileTable:Object(c.a)(s,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("el-table",{key:"mp-erp-product-module-factory-list-page-file-table-comp-wrap",staticClass:"mp-erp-product-module-factory-list-page-file-table-comp-wrap",staticStyle:{width:"100%"},attrs:{"max-height":t.h,height:t.h,stripe:"",border:"",data:t.localTableData,fit:""}},[i("el-table-column",{attrs:{prop:"conditionText",label:"条件","min-width":"260"},scopedSlots:t._u([{key:"default",fn:function(e){return[Array.isArray(e.row.conditionText)?i("el-tooltip",{attrs:{effect:"light","popper-class":"common-property-condition-text-tips-box"}},[i("div",{attrs:{slot:"content"},slot:"content"},t._l(e.row.conditionText,(function(a,o){return i("p",{key:a.name+"tips"+o},[o>0?i("span",{staticClass:"type"},[t._v(t._s(1===e.row.Constraint.FilterType?"且":"或"))]):t._e(),i("span",{staticClass:"name"},[t._v(t._s(a.name))]),i("span",{staticClass:"is-origin"},[t._v(t._s(a.operator))]),i("span",{staticClass:"val"},[t._v(t._s(a.val))]),o===e.row.conditionText.length-1?i("span",{staticStyle:{"margin-left":"2px"}},[t._v(" 。")]):i("span",{staticStyle:{"margin-left":"2px"}},[t._v("；")])])})),0),i("div",{staticClass:"common-property-condition-text-content-box"},t._l(e.row.conditionText,(function(a,o){return i("p",{key:a.name+"content"+o},[o>0?i("span",{staticClass:"type"},[t._v(t._s(1===e.row.Constraint.FilterType?"且":"或"))]):t._e(),i("span",[t._v(t._s(a.name))]),i("span",{staticClass:"is-origin"},[t._v(t._s(a.operator))]),i("span",[t._v(t._s(a.val))])])})),0)]):i("span",[t._v(t._s(e.row.conditionText))])]}}])}),i("el-table-column",{attrs:{prop:"FilterTypeText",label:"条件类型",width:"180","show-overflow-tooltip":""}}),i("el-table-column",{attrs:{prop:"PriorityText",label:"优先级",width:"140","show-overflow-tooltip":""}}),i("el-table-column",{attrs:{prop:"FileInfoText",label:"文件类目",width:"420","show-overflow-tooltip":""}}),i("el-table-column",{attrs:{label:"操作",width:"240"},scopedSlots:t._u([{key:"default",fn:function(e){return i("div",{staticClass:"menu-list"},[i("span",{on:{click:function(i){return t.onEditClick(e.row)}}},[i("i"),t._v("编辑")]),i("span",{on:{click:function(i){return t.onRemoveClick(e.row,e.$index)}}},[i("i"),t._v("删除")])])}}])}),i("div",{attrs:{slot:"empty"},slot:"empty"},[i("span",{directives:[{name:"show",rawName:"v-show",value:!t.loading,expression:"!loading"}]},[t._v("暂无数据")])])],1)}),[],!1,null,null,null).exports},computed:Object(o.a)({},Object(n.e)("productManage",["ProductManageList","ProductModuleKeyIDList","ProductFileList","ProductFilePropertyList"]),{curProduct:function(){var t=this;return this.ProductID?this.ProductManageList.find((function(e){return e.ID===t.ProductID})):null},curPart:function(){var t=this;return this.PartID&&this.curProduct?this.curProduct.PartList.find((function(e){return e.ID===t.PartID})):null},localTableData:function(){var t=this;return this.ProductFileList&&0!==this.ProductFileList.length?JSON.parse(JSON.stringify(this.ProductFileList)).map((function(e){var i=e.Constraint;return i.ItemList=i.ItemList.map((function(e){var i=l.d.getPerfectPropertyByImperfectProperty(e.Property,t.ProductFilePropertyList);return Object(o.a)({},e,{Property:i})})).filter((function(t){return t.Property})),Object(o.a)({},e,{Constraint:i})})):[]}}),methods:{getPositionID:function(){if(this.$route.params){var t=this.$route.params,e=t.ProductID,i=t.PartID,a=t.name,o=t.type;e&&i&&a&&o?(this.ProductID=e,this.PartID="null"!==i?i:"",this.ProductName=a,this.titleType=o,this.getProductOrderData(),this.getPropertyList()):this.onGoBackClick()}else this.onGoBackClick()},onFileSaveClick:function(t){this.$store.commit("productManage/setCurEditFileData",t);var e="/ProductFileSet/".concat(this.ProductID,"/").concat(this.PartID?this.PartID:"null","/").concat(this.ProductName,"/").concat(this.titleType,"/").concat(Date.now());this.$router.push(e)},getProductOrderData:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:["File"];return Object(a.a)(regeneratorRuntime.mark((function i(){var a,o,n;return regeneratorRuntime.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return a=t.PartID?t.PartID:t.ProductID,o=t.$utils.getIDFromListByNames(e,t.ProductModuleKeyIDList),n={ID:a,List:o},t.loading=!0,i.next=6,t.$store.dispatch("productManage/getProductFileList",n);case 6:t.loading=!1;case 7:case"end":return i.stop()}}),i)})))()},getPropertyList:function(){this.$store.dispatch("productManage/getProductFilePropertyList",this.ProductID)},onGoBackClick:function(){this.$router.replace("/ProductManageList")},onRemove:function(t,e){var i=this,a=t.FileList.map((function(t){return t.File.Name})).join("、"),o=t.FileList.length>2?"其中文件类目数量共 [ ".concat(t.FileList.length," ]条"):"文件类目：[ ".concat(a," ]");this.messageBox.warnCancelBox("确定删除该条文件类目设置吗",o,(function(){i.$store.dispatch("productManage/getProductFilePropertyRemove",[t.ID,e])}))},onEdit:function(t){this.onFileSaveClick(t)}},mounted:function(){this.getPositionID()}},d=(i("50ed"),Object(c.a)(u,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("section",{staticClass:"mp-erp-product-list-page-product-file-list-page-wrap"},[i("header",[i("span",[t._v("当前"+t._s(t.titleType)+"：")]),i("span",[t._v(t._s(t.ProductName))]),i("p",[i("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(e){return t.onFileSaveClick(null)}}},[t._v("+添加关联")])],1)]),i("main",[i("FileTable",{attrs:{dataList:t.localTableData,loading:t.loading,PropertyList:t.ProductFilePropertyList},on:{remove:t.onRemove,edit:t.onEdit}})],1),i("footer",[i("el-button",{on:{click:t.onGoBackClick}},[i("i",{staticClass:"el-icon-d-arrow-left"}),t._v(" 返回")])],1)])}),[],!1,null,null,null));e.default=d.exports}}]);